<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MCQ Reels App</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: start;
      min-height: 100vh;
      padding-top: 20px;
    }

    /* 1) wrap & center the filters */
    #filterBar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    #filterBar select {
      margin: 5px;
      padding: 5px;
      font-size: 0.9em;
    }

    .phone-frame {
      max-width: 400px;
      height: 100vh;
      margin: 0 auto;
      border: 12px solid #000;
      border-radius: 40px;
      box-shadow: 0 10px 15px rgba(0,0,0,0.2);
      background: #fff;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #scoreboard {
      background: #fff;
      padding: 10px 0;
      text-align: center;
      font-weight: bold;
      border-bottom: 1px solid #eee;
    }
    #cards {
      flex: 1;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
    }
    .card {
      scroll-snap-align: start;
      min-height: 640px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 30px 20px;
      border-bottom: 1px solid #fff;
    }
    .card h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.1em;
      line-height: 1.3;
    }
    .option {
      width: 90%;
      padding: 12px;
      margin: 6px 0;
      border: none;
      border-radius: 12px;
      font-size: 1em;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background: #ffffffaa;
      transition: background 0.3s;
    }
    .option.correct { background: #d4edda !important; }
    .option.wrong   { background: #f8d7da !important; }
    .explanation {
      margin-top: 10px;
      font-size: 0.85em;
      font-style: italic;
      color: #555;
      display: none;
      width: 90%;
      text-align: left;
    }

    #leaderboardPanel {
      position: fixed;
      top: 0;
      right: 0;
      width: 280px;
      height: 100%;
      background: #fff;
      box-shadow: -4px 0 8px rgba(0,0,0,0.2);
      padding: 20px;
      overflow-y: auto;
      display: none;
      z-index: 5;
    }
    #leaderboardPanel h2 {
      margin-top: 0;
      font-size: 1.1em;
    }

    /* 2) stack into one column on small screens,
          3) make phone-frame fluid below 768px */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
        align-items: center;
        padding: 1rem 0 2rem;
      }
      .phone-frame {
        width: 90vw;
        max-width: 400px;
        height: calc(90vh - 4rem);
        margin-top: 1rem;
      }
    }
  </style>
</head>
<body>

  <div id="filterBar">
    <label>Lang:
      <select id="langFilter"></select>
    </label>
    <label>Topic:
      <select id="topicFilter"></select>
    </label>
    <label>Diff:
      <select id="diffFilter"></select>
    </label>
  </div>

  <div class="phone-frame">
    <div id="scoreboard">Score: 0 / 0 | XP: 0 | Streak: 0</div>
    <div id="cards"></div>
  </div>

  <div id="leaderboardPanel">
    <h2>Leaderboard & Profile</h2>
    <div id="leaderboard"></div>
  </div>

  <script>
    // — your quiz data + logic unchanged —
    var cards = JSON.parse(atob('W3sicXVlc3Rpb24iOiAiV2hhdCBpcyB0aGUgb3V0cHV0IG9mICdybnUnLnVwcGVyKCk/IiwgIm9wdGlvbnMiOiBbIlJOVSIsICJybnUiLCAiUm51IiwgIlVOUiJdLCAiY29ycmVjdCI6IDAsICJsYW5ndWFnZSI6ICJQeXRob24iLCAidG9waWMiOiAiRGF0YSBTdHJ1Y3R1cmVzIiwgImRpZmZpY3VsdHkiOiAiRWFzeSIsICJleHBsYW5hdGlvbiI6ICJ1cHBlcigpIHJldHVybnMgYWxsIHVwcGVyY2FzZTogUk5VIn0s ... rest of your base64 deck ...'));
    var filtered = cards.slice();
    var score = 0, XP = 0, streak = 0;

    function randomPastel() {
      const h = Math.floor(Math.random()*360);
      return 'hsl(' + h + ', 60%, 93%)';
    }

    var userName = localStorage.getItem('quizUserName');
    if (!userName) {
      userName = prompt('Enter your username:') || 'Anonymous';
      localStorage.setItem('quizUserName', userName);
    }

    function populateFilters() {
      var langs = ['All'], topics = ['All'], diffs = ['All'];
      cards.forEach(c => {
        if (!langs.includes(c.language))   langs.push(c.language);
        if (!topics.includes(c.topic))     topics.push(c.topic);
        if (!diffs.includes(c.difficulty)) diffs.push(c.difficulty);
      });
      ['langFilter','topicFilter','diffFilter'].forEach(id => {
        const sel = document.getElementById(id);
        sel.innerHTML = '';
        (id==='langFilter'?langs: id==='topicFilter'?topics:diffs)
          .forEach(v => { const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o); });
      });
    }

    function applyFilters() {
      const lang  = document.getElementById('langFilter').value;
      const topic = document.getElementById('topicFilter').value;
      const diff  = document.getElementById('diffFilter').value;
      filtered = cards.filter(c =>
        (lang  === 'All' || c.language   === lang)  &&
        (topic === 'All' || c.topic      === topic) &&
        (diff  === 'All' || c.difficulty === diff)
      );
      score=0; XP=0; streak=0;
      updateScoreboard();
      renderCards();
    }

    function renderCards() {
      const container = document.getElementById('cards');
      container.innerHTML = '';
      filtered.forEach((c, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.background = randomPastel();
        const q = document.createElement('h2');
        q.textContent = (idx+1) + '. ' + c.question;
        card.appendChild(q);

        c.options.forEach((opt,i) => {
          const btn = document.createElement('button');
          btn.className = 'option';
          btn.textContent = opt;
          btn.onclick = function() {
            if (btn.classList.contains('correct') || btn.classList.contains('wrong')) return;
            card.querySelectorAll('.option').forEach(b => b.disabled = true);
            const expl = card.querySelector('.explanation');
            expl.style.display = 'block';
            if (i === c.correct) {
              btn.classList.add('correct');
              score++; XP += 10; streak++;
              expl.textContent = c.explanation;
            } else {
              btn.classList.add('wrong');
              card.querySelectorAll('.option')[c.correct].classList.add('correct');
              streak = 0;
              expl.textContent = 'Correct: ' + c.options[c.correct] + '. ' + c.explanation;
            }
            updateScoreboard();
            recordResult();
          };
          card.appendChild(btn);
        });

        const expl = document.createElement('div');
        expl.className = 'explanation';
        card.appendChild(expl);
        container.appendChild(card);
      });
    }

    function updateScoreboard() {
      document.getElementById('scoreboard').textContent =
        'Score: ' + score + ' / ' + filtered.length +
        ' | XP: ' + XP + ' | Streak: ' + streak;
    }

    function recordResult() {
      let results = JSON.parse(localStorage.getItem('quizLeaderboard')||'[]');
      let e = results.find(r=>r.name===userName);
      if (e) { if (XP>e.xp) e.xp = XP; }
      else results.push({name:userName,xp:XP});
      localStorage.setItem('quizLeaderboard', JSON.stringify(results));
    }

    function updateLeaderboard() {
      let results = JSON.parse(localStorage.getItem('quizLeaderboard')||'[]');
      results.sort((a,b)=>b.xp-a.xp);
      const lb = document.getElementById('leaderboard');
      lb.innerHTML = '';
      results.forEach((it,i)=> {
        const row = document.createElement('div');
        row.textContent = (i+1) + '. ' + it.name + ' - ' + it.xp + ' XP';
        lb.appendChild(row);
      });
    }

    function showLeaderboard() {
      updateLeaderboard();
      document.getElementById('leaderboardPanel').style.display = 'block';
    }
    function hideLeaderboard() {
      document.getElementById('leaderboardPanel').style.display = 'none';
    }

    let touchStartX = null;
    document.body.addEventListener('touchstart', e => touchStartX = e.changedTouches[0].screenX);
    document.body.addEventListener('touchend', e => {
      let endX = e.changedTouches[0].screenX;
      if (touchStartX - endX > 50) showLeaderboard();
      else if (endX - touchStartX > 50) hideLeaderboard();
    });

    populateFilters();
    ['langFilter','topicFilter','diffFilter'].forEach(id=>
      document.getElementById(id).addEventListener('change', applyFilters)
    );
    renderCards();
    updateScoreboard();
  </script>

</body>
</html>
